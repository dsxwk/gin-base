# 郑重提示

本文档由`大师兄`整理编写邮箱25076778@qq.com，严禁转载。
禁止将本项目用于含病毒、木马、色情、赌博、诈骗、违禁用品、假冒产品、虚假信息、数字货币、金融等违法违规业务

当前项目仅供个人学习测试，禁止一切线上商用行为，禁止一切违法使用！！！

## 项目地址
- Github: https://github.com/dsxwk/gin-base.git
- Gitee: https://gitee.com/dsxwk/gin-base.git

## Gin框架介绍

Gin是一个用Go语言编写的Web框架。它具有简单、快速、高效等特点，被广泛应用于Go语言的Web开发中。

Gin框架的特性包括：

- 快速：Gin框架基于标准库`net/http`，使用`goroutine`和`channel`实现异步处理，提高性能。
- 简单：Gin框架提供了一系列的API和中间件，使得开发人员可以快速构建Web应用程序。
- 高效：Gin框架使用`sync.Pool`来缓存对象，减少内存分配和释放，提高性能。

Golang Gin 是一个轻量级且高效的 Golang Web 框架。它具有高性能、易用性和灵活性等特点，被广泛应用于各种 Web 应用程序的开发。

## 项目截图

![img.png](./img.png)
![img_1.png](./img_1.png)
![img_2.png](./img_2.png)

## Gin-Base项目介绍
- 命令行生成快捷创建模型、控制器、服务、验证器、中间件
- 验证器以及自定义验证场景
- Jwt鉴权
- 缓存
- Air
- ...

## 后端使用技术

- Gin
- Gorm
- Jwt
- Mysql
- Validator
- Cache

## 前端使用技术

- Vue3
- Vite
- Element-Plus
- Element-Plus-Table

## go-base目录结构

```bash
├── app                                 # 应用程序代码
│   ├── controller                      # 控制期
│   ├── model                           # 模型
│   ├── service                         # 服务
│   ├── validate                        # 验证器
│   ├── middleware                      # 中间件
├── cli                                 # 命令行
├── common                              # 公共模块
│   ├── global                          # 全局变量
├── config                              # 配置文件
├── docs                                # 文档
├── database                            # 测试数据库文件
├── helper                              # 工具类
├── log                                 # 日志文件
├── resource                            # 静态资源
├── web                                 # Web服务
├── routers                             # 路由
├── vendor                              # 依赖包
```

## web目录结构
## 目录结构

```bash
├── app                                 # 应用
│   ├── modules                         # 模块
├── components                          # 组件
├── config                              # 配置
├── enums                               # 枚举
├── node_modules                        # npm包
├── public                              # 静态资源
├── docs                                # 文档
├── routers                             # 路由
├── src                                 # 核心js源码
├── utils                               # 工具助手类
├── views                               # 视图文件
```

## 使用
### 运行前后端

```bash
# 后端运行 端口8080 接口地址:127.0.0.1:8080/api/v1/...
cd path/to/your/backend
go mod download
go mod tidy vendor
go run main.go # 或 air
```

```bash
# 前端运行 端口3000 访问地址:127.0.0.1:3000
cd path/to/your/frontend
npm install
npm run dev
```
### 命令行生成

```bash
# 公共参数 --make=<model|controller|service|validate|middleware>
# 生成模型 
# --tableName=<user(你的表名)> --camel=true|false(true:生成驼峰字段,false:生成下划线字段)
go run ./cli/main.go --make=model --tableName=user --camel=true

# 生成控制器
# --fileName=</app/controller/v1/test(生成的文件路径)> --function=<List|Create|Update|Delete|Detail ...(方法名称)> --method=<get|post|put|delete(请求方式)> --router=</v1/user(访问路由)> --description=<方法注释>
go run ./cli/main.go --make=controller  --fileName=/app/controller/v1/test --function=List --method=get --router=/v1/list --description=测试

# 生成服务
# --fileName=</app/service/test(生成的文件路径)> --function=<List|Create|Update|Delete|Detail ...(方法名称)> --description=<方法注释>
go run ./cli/main.go --make=service  --fileName=/app/service/test --function=List --description=测试

# 生成验证器
# --fileName=</app/validate/test(生成的文件路径)> --description=<方法注释>
go run ./cli/main.go --make=validate  --fileName=/app/validate/test --description=测试

# 生成中间件
# --fileName=</app/middleware/test(生成的文件路径)> --description=<方法注释>
go run ./cli/main.go --make=middleware  --fileName=/app/middleware/test --description=测试 
```
### 生成模型结构示例

```go
// Code generated by gorm.io/gen. DO NOT EDIT.
// Code generated by gorm.io/gen. DO NOT EDIT.
// Code generated by gorm.io/gen. DO NOT EDIT.

package model

import (
	"encoding/json"
	"gorm.io/gorm"
	"time"
)

const TableNameArticle = "article"

// Article mapped from table <article>
type Article struct {
	ID         int64     `gorm:"column:id;type:int(10) unsigned;primaryKey;autoIncrement:true;comment:ID" json:"id"`  // ID
	UID        int64     `gorm:"column:uid;type:int(11);not null;comment:用户id" json:"uid"`                            // 用户id
	User       *User     `json:"user" gorm:"foreignkey:uid;references:id"`                                            // 关联用户
	Title      string    `gorm:"column:title;type:varchar(50);not null;comment:标题" json:"title"`                      // 标题
	Content    string    `gorm:"column:content;type:varchar(255);not null;comment:内容" json:"content"`                 // 内容
	CategoryID int64     `gorm:"column:category_id;type:int(11);not null;comment:分类id" json:"category_id"`            // 分类id
	DataSource int64     `gorm:"column:data_source;type:int(11);not null;comment:数据来源 1=文章库 2=自建" json:"data_source"` // 数据来源 1=文章库 2=自建
	IsPublish  int64     `gorm:"column:is_publish;type:int(11);not null;comment:是否发布 1=已发布 2=未发布" json:"is_publish"`  // 是否发布 1=已发布 2=未发布
	Category   *Category `json:"category" gorm:"foreignkey:category_id;references:id"`                                // 关联分类
	Tag        *string   `gorm:"column:tag;type:json;comment:标签" json:"tag"`                                          // 标签
	CreatedAt  *string   `gorm:"column:created_at;type:datetime;comment:创建时间" json:"created_at"`                      // 创建时间
	UpdatedAt  *string   `gorm:"column:updated_at;type:datetime;comment:更新时间" json:"updated_at"`                      // 更新时间
	DeletedAt  *string   `gorm:"column:deleted_at;type:datetime;comment:删除时间" json:"deleted_at"`                      // 删除时间
}

type ArticleQuery struct {
	ID         int64     `json:"id" comment:"ID"`                                                     // ID
	UID        int64     `json:"uid" comment:"用户id"`                                                  // 用户id
	User       *User     `json:"user" gorm:"foreignkey:uid;references:id" comment:"关联用户"`             // 关联用户
	Title      string    `json:"title" comment:"标题"`                                                  // 标题
	Content    string    `json:"content" comment:"内容"`                                                // 内容
	CategoryID int64     `json:"category_id" comment:"分类id"`                                          // 分类id
	DataSource int64     `json:"data_source" comment:"数据来源 1=文章库 2=自建"`                               // 数据来源 1=文章库 2=自建
	IsPublish  int64     `json:"is_publish" comment:"是否发布 1=已发布 2=未发布"`                               // 是否发布 1=已发布 2=未发布
	Category   *Category `json:"category" gorm:"foreignkey:category_id;references:id" comment:"关联分类"` // 关联分类
	Tag        []string  `json:"tag" comment:"标签"`                                                    // 标签
}

// TableName Article's table name
func (*Article) TableName() string {
	return TableNameArticle
}

// 创建之前
func (s *Article) BeforeCreate(tx *gorm.DB) (err error) {
	if s.CreatedAt == nil {
		createdAt := time.Now().Format("2006-01-02 15:04:05")
		s.CreatedAt = &createdAt
	}

	if s.UpdatedAt == nil {
		updatedAt := time.Now().Format("2006-01-02 15:04:05")
		s.UpdatedAt = &updatedAt
	}

	return
}

// 更新之前
func (s *Article) BeforeUpdate(tx *gorm.DB) (err error) {
	if s.UpdatedAt == nil {
		updatedAt := time.Now().Format("2006-01-02 15:04:05")
		s.UpdatedAt = &updatedAt
	}

	return
}

// 查询之后
func (s *Article) AfterFind(tx *gorm.DB) (err error) {
	// 时间格式转换
	if s.CreatedAt != nil {
		createdAt, _ := time.Parse(time.RFC3339, *s.CreatedAt)
		// 格式化 time.Time 类型为字符串，并重新赋值给 *string 类型的字段
		formattedCreatedAt := createdAt.Format("2006-01-02 15:04:05")
		s.CreatedAt = &formattedCreatedAt
	}

	if s.UpdatedAt != nil {
		updatedAt, _ := time.Parse(time.RFC3339, *s.UpdatedAt)
		// 格式化 time.Time 类型为字符串，并重新赋值给 *string 类型的字段
		formattedUpdatedAt := updatedAt.Format("2006-01-02 15:04:05")
		s.UpdatedAt = &formattedUpdatedAt
	}

	if s.DeletedAt != nil {
		deletedAt, _ := time.Parse(time.RFC3339, *s.DeletedAt)
		// 格式化 time.Time 类型为字符串，并重新赋值给 *string 类型的字段
		formattedDeletedAt := deletedAt.Format("2006-01-02 15:04:05")
		s.DeletedAt = &formattedDeletedAt
	}

	return
}

// 删除之前
func (s *Article) BeforeDelete(tx *gorm.DB) (err error) {
	if s.DeletedAt == nil {
		deletedAt := time.Now().Format("2006-01-02 15:04:05")
		s.DeletedAt = &deletedAt
	}

	return
}
```

## 设置器和获取器
```go
// 获取标签
func (s *Article) GetTag() []string {
	if s != nil && s.Tag != nil {
		var tagJson []string
		json.Unmarshal([]byte(*s.Tag), &tagJson)
		return tagJson
	}
	return nil
}

// 设置标签
func (s *Article) SetTag(tag []string) *string {
	var (
		model Article
	)

	if tag != nil {
		tagJSON, _ := json.Marshal(tag)
		tagStr := string(tagJSON)
		model.Tag = &tagStr
	}
	return model.Tag
}
```

### 设置器和获取器的使用
```go
// List
// @description: 列表
// @param: req validate.ArticleValidate
// @return: global.PageData, error
func (s *ArticleService) List(req validate.ArticleValidate) (global.PageData, error) {
	var (
		articleModel []model.Article
		articleQuery []model.ArticleQuery
		pageData     global.PageData
		//fields       []field
	)

	// 获取分页默认为第一页，每页10条记录
	offset, limit := utils.Pagination(req.Page, req.PageSize)

	// join
	//db := global.DB.Joins("LEFT JOIN user ON article.uid = user.id LEFT JOIN category ON article.category_id = category.id").Select("article.*, user.username, category.name").Find(&articleModel).scan(&fields)

	db := global.DB.Preload("User", func(db *gorm.DB) *gorm.DB {
		return db.Select("id, username, full_name, nickname, email, gender, age")
	}).Preload("Category", func(db *gorm.DB) *gorm.DB {
		return db.Select("id, name")
	}).Find(&articleModel)

	// 获取总记录数
	err := db.Count(&pageData.Total).Error
	if err != nil {
		return pageData, err
	}

	// 执行分页查询
	err = db.Offset(offset).Limit(limit).Find(&articleModel).Scan(&articleQuery).Error
	if err != nil {
		return pageData, err
	}

	for k, m := range articleModel {
		articleQuery[k].User = m.User
		articleQuery[k].Category = m.Category
		articleQuery[k].Tag = m.GetTag()
	}

	pageData.Page = req.Page
	pageData.PageSize = req.PageSize
	pageData.List = articleQuery

	return pageData, nil
}

// Update
// @description: 更新
// @param: req model.Article
// @return: model.Article, error
func (this *ArticleService) Update(req model.ArticleQuery) (model.Article, error) {
    var (
        articleModel model.Article
    )
    
    err := copier.Copy(&articleModel, &req)
    if err != nil {
        return articleModel, err
    }
    articleModel.Tag = articleModel.SetTag(req.Tag)
    
    err = global.DB.Updates(&articleModel).Error
    if err != nil {
        return articleModel, err
    }
    
    return articleModel, nil
}
```

## 缓存使用 支持内存缓存和redis缓存需要在yaml当中指定
```yaml
# 缓存
cache:
  type: "redis"  # memory 或者 "redis"
  redis:
    address: "127.0.0.1:6379"
    password: ""  # 密码为空则不需要
    db: 1
```
### 缓存调用示例
```go
package service

import (
	"gin-base/common"
	"gin-base/common/global"
	"time"
)

type CacheService struct {
	common.BaseService
}

// SetCache
// @description: 设置缓存
// @param: key string, value interface{}, expire time.Duration
// @return: interface{}
func (s *CacheService) SetCache(key string, value interface{}, expire time.Duration) interface{} {
	global.Cache.SetCache(key, value, expire)

	return true
}

// GetCache
// @description: 获取缓存
// @param: key string
// @return: interface{}
func (s *CacheService) GetCache(key string) (interface{}, bool) {
	res, ok := global.Cache.GetCache(key)
	if ok {
		return res, ok
	}

	return false, ok
}

// DeleteCache
// @description: 删除缓存
// @param: key string
// @return: interface{}
func (s *CacheService) DeleteCache(key string) interface{} {
	global.Cache.DeleteCache(key)

	return true
}

```

## air使用
### 更新代码无需重启将自动重启更新
```shell
 E:\www\dsx\gin-base> air

  __    _   ___
 / /\  | | | |_)
/_/--\ |_| |_| \_ v1.60.0, built with Go go1.23.1

watching .
watching app
watching app\controller
watching app\controller\v1
watching app\middleware
watching app\model
watching app\service
watching app\validate
watching cli
watching common
watching common\global
watching common\template
watching config
watching database
watching helper
watching helper\utils
watching log
watching resource
watching resource\images
watching routers
!exclude tmp
!exclude vendor
building...
!exclude .git
!exclude .git
running...
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:   export GIN_MODE=release
 - using code:  gin.SetMode(gin.ReleaseMode)

[GIN-debug] GET    /ping                     --> main.main.func1 (3 handlers)
[GIN-debug] GET    /resource/*filepath       --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)
[GIN-debug] HEAD   /resource/*filepath       --> github.com/gin-gonic/gin.(*RouterGroup).createStaticHandler.func1 (3 handlers)
[GIN-debug] POST   /api/v1/login             --> gin-base/app/controller/v1.(*LoginController).Login-fm (4 handlers)
[GIN-debug] GET    /api/v1/user/             --> gin-base/app/controller/v1.(*UserController).List-fm (5 handlers)
[GIN-debug] POST   /api/v1/user/             --> gin-base/app/controller/v1.(*UserController).Create-fm (5 handlers)
[GIN-debug] PUT    /api/v1/user/:id          --> gin-base/app/controller/v1.(*UserController).Update-fm (5 handlers)
[GIN-debug] GET    /api/v1/user/:id          --> gin-base/app/controller/v1.(*UserController).Detail-fm (5 handlers)
[GIN-debug] DELETE /api/v1/user/:id          --> gin-base/app/controller/v1.(*UserController).Delete-fm (5 handlers)
[GIN-debug] GET    /api/v1/article/          --> gin-base/app/controller/v1.(*ArticleController).List-fm (5 handlers)
[GIN-debug] POST   /api/v1/article/          --> gin-base/app/controller/v1.(*ArticleController).Create-fm (5 handlers)
[GIN-debug] PUT    /api/v1/article/:id       --> gin-base/app/controller/v1.(*ArticleController).Update-fm (5 handlers)
[GIN-debug] GET    /api/v1/article/:id       --> gin-base/app/controller/v1.(*ArticleController).Detail-fm (5 handlers)
[GIN-debug] DELETE /api/v1/article/:id       --> gin-base/app/controller/v1.(*ArticleController).Delete-fm (5 handlers)
[GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.
Please check https://pkg.go.dev/github.com/gin-gonic/gin#readme-don-t-trust-all-proxies for details.
[GIN-debug] Listening and serving HTTP on :8080
```

## 登录接口

```http
POST /api/v1/login HTTP/1.1
Host: :8080
Content-Type: application/json
Content-Length: 56

{
    "username": "admin",
    "password": "123456"
}
```

## jwt验证header,获取文章列表示例

```http
GET /api/v1/article?page=1&pageSize=1 HTTP/1.1
Host: :8080
token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwibmFtZSI6IkFkbWluIiwiaWF0IjoxNjc0NjYzMjM5LCJleHAiOjE2NzQ2NjYzMzl9.8W45GJQqV656
```

## 控制器示例

```go
package v1

import (
	"encoding/json"
	"gin-base/app/model"
	"gin-base/app/service"
	"gin-base/app/validate"
	"gin-base/common"
	"gin-base/common/global"
	"github.com/gin-gonic/gin"
	"strconv"
)

type ArticleController struct {
	common.BaseController
}

// List
// @Tags 文章
// @Summary 列表
// @Router /v1/article [get]
func (s *ArticleController) List(c *gin.Context) {
	var (
		articleService service.ArticleService
		req            validate.ArticleValidate
	)

	err := c.ShouldBindQuery(&req)
	if err != nil {
		global.Log.Error(err.Error())
		return
	}

	// 验证
	err = validate.GetArticleValidate(req, "list")
	if err != nil {
		s.ApiResponse(c, global.ArgsError, err.Error(), nil)
		return
	}

	pageData, err := articleService.List(req)
	if err != nil {
		global.Log.Error(err.Error())
		s.ApiResponse(c, global.SystemError, err.Error(), nil)
		return
	}

	s.ApiResponse(c, global.Success, "获取成功", pageData)
}
```

## 验证器以及验证场景

```go
package validate

import (
	"errors"
	validator "github.com/gookit/validate"
)

// ArticleValidate 文章请求验证
type ArticleValidate struct {
	Page     int    `form:"page" validate:"required|int|gt:0" label:"页码"`
	PageSize int    `form:"pageSize" validate:"required|int|gt:0" label:"每页数量"`
	ID       int64  `json:"id" validate:"required" label:"ID"`
	Title    string `json:"title" validate:"required" label:"标题"`
	Content  string `json:"content" validate:"required" label:"内容"`
}

// GetArticleValidate 请求验证
func GetArticleValidate(data ArticleValidate, scene string) error {
	v := validator.Struct(data, scene)
	if !v.Validate(scene) {
		return errors.New(v.Errors.One())
	}

	return nil
}

// ConfigValidation 配置验证
// - 定义验证场景
// - 也可以添加验证设置
func (a ArticleValidate) ConfigValidation(v *validator.Validation) {
	v.WithScenes(validator.SValues{
		"list":   []string{"Page", "PageSize"},
		"create": []string{"Title", "Content"}, // []string{"User.FullName", "Title"}
		"update": []string{"ID", "Title", "Content"},
		"detail": []string{"ID"},
		"delete": []string{"ID"},
	})
}

// Messages 您可以自定义验证器错误消息
func (s ArticleValidate) Messages() map[string]string {
	return validator.MS{
		"required":    "字段 {field} 必填",
		"int":         "字段 {field} 必须为整数",
		"Page.gt":     "字段 {field} 需大于 0",
		"PageSize.gt": "字段 {field} 需大于 0",
	}
}

// Translates 你可以自定义字段翻译
func (s ArticleValidate) Translates() map[string]string {
	return validator.MS{
		"Page":     "页码",
		"PageSize": "每页数量",
		"ID":       "ID",
		"Title":    "标题",
		"Content":  "内容",
	}
}
```

## 路由以及中间件

```go
package routers

import (
	controller "gin-base/app/controller/v1"
	"gin-base/app/middleware"
	"github.com/gin-gonic/gin"
)

var (
	jwtMiddleware = middleware.Jwt{}.JwtMiddleware()
)

// LoadRouters 加载路由
func LoadRouters(router *gin.Engine) {
	// 登录
	login_controller := controller.LoginController{}
	// 用户
	user_controller := controller.UserController{}
	// 文章
	article_controller := controller.ArticleController{}

	// 统一路由分组
	v1 := router.Group("api/v1")
	{
		// 不需要token验证
		// 用户登录
		v1.POST("/login", login_controller.Login)

		// 需要token验证
		// 用户
		user := v1.Group("user", jwtMiddleware)
		{
			// 列表
			user.GET("", user_controller.List)
			// 创建用户
			user.POST("", user_controller.Create)
			// 更新用户
			user.PUT("/:id", user_controller.Update)
			// 用户详情
			user.GET("/:id", user_controller.Detail)
			// 删除用户
			user.DELETE("/:id", user_controller.Delete)
		}

		// 文章
		article := v1.Use(jwtMiddleware)
		{
			// 列表
			article.GET("/article", article_controller.List)
			// 创建
			article.POST("/article", article_controller.Create)
			// 更新
			article.PUT("/article/:id", article_controller.Update)
			// 详情
			article.GET("/article/:id", article_controller.Detail)
			// 删除
			article.DELETE("/article/:id", article_controller.Delete)
		}
	}
}
```

## 缓存
```go

```